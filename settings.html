<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>经历·Farewell - 设置</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; background: #f5f5f5; }
        #sidebar { position: fixed; left: -300px; top: 0; width: 300px; height: 100%; background: white; z-index: 1000; transition: 0.3s; }
        #sidebar.active { left: 0; }
        .sidebar-header { padding: 20px; text-align: center; border-bottom: 1px solid #eee; }
        .sidebar-content { padding: 20px; }
        .sidebar-item { padding: 15px 0; border-bottom: 1px solid #eee; text-align: center; }
        .settings-item { background: white; margin: 15px; border-radius: 10px; padding: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .settings-title { font-weight: bold; margin-bottom: 10px; }
        .settings-content { color: #666; }
        #menu-btn { position: fixed; left: 20px; top: 20px; z-index: 1000; background: white; border: none; border-radius: 50%; width: 40px; height: 40px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
    </style>
</head>
<body>
    <button id="menu-btn"><i class="fas fa-bars"></i></button>
    
    <div id="sidebar">
        <div class="sidebar-header">
            <div class="user-avatar" style="width: 80px; height: 80px; border-radius: 50%; background: #eee; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-user" style="font-size: 30px; color: #888;"></i>
            </div>
            <div class="user-name">用户名</div>
        </div>
        <div class="sidebar-content">
            <div class="sidebar-item" onclick="window.location.href='footprints.html'">我的足迹</div>
            <div class="sidebar-item" onclick="window.location.href='categories.html'">我的分类</div>
            <div class="sidebar-item" onclick="window.location.href='settings.html'">设置</div>
            <div class="sidebar-item" onclick="window.location.href='main.html'">back to the world</div>
        </div>
    </div>
    
    <div class="settings-list">
        <div class="settings-item" onclick="changeAvatar()">
            <div class="settings-title">修改头像</div>
            <div class="settings-content">点击上传新头像</div>
        </div>
        
        <div class="settings-item" onclick="changeNickname()">
            <div class="settings-title">修改昵称</div>
            <div class="settings-content">点击修改您的昵称</div>
        </div>
        
        <div class="settings-item" onclick="showColorPicker()">
            <div class="settings-title">主题颜色</div>
            <div class="settings-content">点击选择主题色</div>
        </div>
        
        <!-- 颜色选择对话框 -->
        <div id="color-picker-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center;">
            <div style="background:white; padding:20px; border-radius:10px; width:300px;">
                <h4 style="margin-bottom:15px;">选择主题颜色</h4>
                
                <div style="display:flex; flex-wrap:wrap; gap:10px; margin-bottom:15px;">
                    <div style="width:40px; height:40px; border-radius:50%; background:#4285f4; cursor:pointer;" onclick="selectColor('#4285f4')"></div>
                    <div style="width:40px; height:40px; border-radius:50%; background:#34a853; cursor:pointer;" onclick="selectColor('#34a853')"></div>
                    <div style="width:40px; height:40px; border-radius:50%; background:#fbbc05; cursor:pointer;" onclick="selectColor('#fbbc05')"></div>
                    <div style="width:40px; height:40px; border-radius:50%; background:#ea4335; cursor:pointer;" onclick="selectColor('#ea4335')"></div>
                    <div style="width:40px; height:40px; border-radius:50%; background:#673ab7; cursor:pointer;" onclick="selectColor('#673ab7')"></div>
                    <div style="width:40px; height:40px; border-radius:50%; background:#00bcd4; cursor:pointer;" onclick="selectColor('#00bcd4')"></div>
                    <div style="width:40px; height:40px; border-radius:50%; background:#ff5722; cursor:pointer;" onclick="selectColor('#ff5722')"></div>
                </div>
                
                <input type="color" id="custom-color" style="width:100%; margin-bottom:15px;">
                
                <div style="display:flex; justify-content:space-between;">
                    <button onclick="document.getElementById('color-picker-modal').style.display='none'" style="padding:8px 15px; background:#f5f5f5; border:none; border-radius:5px; cursor:pointer;">取消</button>
                    <button onclick="selectCustomColor()" style="padding:8px 15px; background:#4285f4; color:white; border:none; border-radius:5px; cursor:pointer;">确定</button>
                </div>
            </div>
        </div>
        <div class="about-app" onclick="showAppInfo()" style="text-align: center; color: #999; font-size: 0.8em; text-decoration: underline; margin-top: 30px; padding: 10px; cursor: pointer;">关于应用</div>
        
        <!-- 应用信息对话框 -->
        <div id="app-info-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center;">
            <div style="background:white; padding:20px; border-radius:10px; width:300px;">
                <h4 style="margin-bottom:15px;">应用信息</h4>
                <p>1. 版本号：v 0.0.3-alpha.1</p>
                <p>2. 开发人员：槐商</p>
                <button onclick="document.getElementById('app-info-modal').style.display='none'" style="padding:8px 15px; background:#f5f5f5; border:none; border-radius:5px; cursor:pointer; margin-top:15px;">关闭</button>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 拖拽功能实现
        document.addEventListener('DOMContentLoaded', function() {
            const btn = document.getElementById('menu-btn');
            let isDragging = false;
            let offsetX, offsetY;
            
            // 从本地存储加载用户信息
            const userAvatar = localStorage.getItem('userAvatar');
            const userNickname = localStorage.getItem('userNickname') || '用户名';
            
            // 更新侧边栏用户信息
            if (userAvatar) {
                document.querySelector('.user-avatar').innerHTML = 
                    `<img src="${userAvatar}" style="width:100%;height:100%;border-radius:50%;object-fit:cover;">`;
            }
            document.querySelector('.user-name').textContent = userNickname;
            
            // 拖拽功能
            function setupDrag(element) {
                let isDragging = false;
                let startX, startY, startLeft, startTop;
                
                // 鼠标/触摸开始事件
                function handleStart(e) {
                    e.preventDefault();
                    isDragging = true;
                    
                    const clientX = e.clientX || e.touches[0].clientX;
                    const clientY = e.clientY || e.touches[0].clientY;
                    
                    startX = clientX;
                    startY = clientY;
                    startLeft = parseInt(window.getComputedStyle(element).left);
                    startTop = parseInt(window.getComputedStyle(element).top);
                    
                    document.addEventListener('mousemove', handleMove);
                    document.addEventListener('touchmove', handleMove, { passive: false });
                    document.addEventListener('mouseup', handleEnd);
                    document.addEventListener('touchend', handleEnd);
                }
                
                // 移动事件
                function handleMove(e) {
                    if (!isDragging) return;
                    e.preventDefault();
                    
                    const clientX = e.clientX || e.touches[0].clientX;
                    const clientY = e.clientY || e.touches[0].clientY;
                    
                    const dx = clientX - startX;
                    const dy = clientY - startY;
                    
                    // 限制在可视范围内
                    const maxX = window.innerWidth - element.offsetWidth;
                    const maxY = window.innerHeight - element.offsetHeight;
                    
                    const newLeft = Math.max(0, Math.min(startLeft + dx, maxX));
                    const newTop = Math.max(0, Math.min(startTop + dy, maxY));
                    
                    element.style.left = newLeft + 'px';
                    element.style.top = newTop + 'px';
                }
                
                // 结束事件
                function handleEnd() {
                    isDragging = false;
                    document.removeEventListener('mousemove', handleMove);
                    document.removeEventListener('touchmove', handleMove);
                    document.removeEventListener('mouseup', handleEnd);
                    document.removeEventListener('touchend', handleEnd);
                }
                
                element.addEventListener('mousedown', handleStart);
                element.addEventListener('touchstart', handleStart, { passive: false });
            }
            
            setupDrag(btn);
            
            let lastLeft = 20;
let lastTop = 20;

btn.addEventListener('click', function(e) {
    const currentLeft = parseInt(window.getComputedStyle(this).left);
    const currentTop = parseInt(window.getComputedStyle(this).top);
    
    // 只有位置没有变化时才执行返回初始位置和呼出侧边栏的逻辑
    if (currentLeft === lastLeft && currentTop === lastTop) {
        // 添加返回初始位置的动画效果
        this.style.transition = 'left 0.3s ease, top 0.3s ease';
        this.style.left = '20px';
        this.style.top = '20px';
        
        // 动画结束后移除transition属性
        setTimeout(() => {
            this.style.transition = '';
        }, 300);
        
        document.getElementById('sidebar').classList.toggle('active');
        // 切换菜单按钮图标
        const icon = this.querySelector('i');
        if (document.getElementById('sidebar').classList.contains('active')) {
            icon.classList.replace('fa-bars', 'fa-times');
        } else {
            icon.classList.replace('fa-times', 'fa-bars');
        }
    }
    
    // 更新最后记录的位置
    lastLeft = currentLeft;
    lastTop = currentTop;
});

// 菜单项点击效果
document.querySelectorAll('.sidebar-item').forEach(item => {
    item.addEventListener('click', function() {
        // 移除所有菜单项的active类
        document.querySelectorAll('.sidebar-item').forEach(i => {
            i.classList.remove('active');
        });
        // 为当前点击项添加active类
        this.classList.add('active');
        // 关闭侧边栏
        document.getElementById('sidebar').classList.remove('active');
        document.getElementById('menu-btn').querySelector('i')
            .classList.replace('fa-times', 'fa-bars');
    });
});

// 点击页面空白处关闭侧边栏
document.addEventListener('click', function(e) {
    const sidebar = document.getElementById('sidebar');
    const menuBtn = document.getElementById('menu-btn');
    
    if (sidebar.classList.contains('active') && 
        !sidebar.contains(e.target) && 
        e.target !== menuBtn && 
        !menuBtn.contains(e.target)) {
        
        sidebar.classList.remove('active');
        menuBtn.querySelector('i').classList.replace('fa-times', 'fa-bars');
    }
});
    
    // 更新最后记录的位置
    lastLeft = currentLeft;
    lastTop = currentTop;
});
            
            // 菜单项点击效果
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.addEventListener('click', function() {
                    // 移除所有菜单项的active类
                    document.querySelectorAll('.sidebar-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    // 为当前点击项添加active类
                    this.classList.add('active');
                    // 关闭侧边栏
                    document.getElementById('sidebar').classList.remove('active');
                    document.getElementById('menu-btn').querySelector('i')
                        .classList.replace('fa-times', 'fa-bars');
                });
            });
        });
        function showFrame(frameId) {
            parent.showFrame(frameId);
        }
        
        function changeAvatar() {
            // 创建文件输入元素
            const fileInput = document.createElement('input');
            fileInput.type = 'file';
            fileInput.accept = 'image/*';
            fileInput.style.display = 'none';
            
            // 添加change事件处理
            fileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                // 创建文件阅读器
                const reader = new FileReader();
                reader.onload = function(e) {
                    const avatarUrl = e.target.result;
                    // 保存到本地存储
                    localStorage.setItem('userAvatar', avatarUrl);
                    // 更新侧边栏头像
                    if (window.parent && window.parent.updateAvatar) {
                        window.parent.updateAvatar(avatarUrl);
                    }
                    alert('头像上传成功！');
                };
                reader.readAsDataURL(file);
            });
            
            // 触发文件选择
            document.body.appendChild(fileInput);
            fileInput.click();
            document.body.removeChild(fileInput);
        }
        
        function changeNickname() {
            const currentNickname = localStorage.getItem('userNickname') || '';
            const newNickname = prompt('请输入新的昵称：', currentNickname);
            if (newNickname) {
                alert('昵称已修改为：' + newNickname);
                // 保存昵称到本地存储
                localStorage.setItem('userNickname', newNickname);
                // 更新界面显示
                updateNicknameDisplay(newNickname);
            }
        }
        
        function updateNicknameDisplay(nickname) {
            const nicknameDisplay = document.querySelector('.settings-item:nth-child(2) .settings-content');
            if (nicknameDisplay) {
                nicknameDisplay.textContent = nickname || '点击修改您的昵称';
            }
        }
        
        // 页面加载时初始化昵称显示
        document.addEventListener('DOMContentLoaded', function() {
            const savedNickname = localStorage.getItem('userNickname');
            if (savedNickname) {
                updateNicknameDisplay(savedNickname);
            }
            
            // 初始化主题颜色
            const savedColor = localStorage.getItem('themeColor');
            if (savedColor) {
                applyThemeColor(savedColor);
            }
        });
        
        // 显示颜色选择器
        function showColorPicker() {
            document.getElementById('color-picker-modal').style.display = 'flex';
        }
        
        // 选择预设颜色
        function selectColor(color) {
            localStorage.setItem('themeColor', color);
            applyThemeColor(color);
            document.getElementById('color-picker-modal').style.display = 'none';
            alert('主题颜色已更新！');
        }
        
        // 选择自定义颜色
        function selectCustomColor() {
            const color = document.getElementById('custom-color').value;
            localStorage.setItem('themeColor', color);
            applyThemeColor(color);
            document.getElementById('color-picker-modal').style.display = 'none';
            alert('主题颜色已更新！');
        }
        
        // 应用主题颜色
        function applyThemeColor(color) {
            document.documentElement.style.setProperty('--primary-color', color);
            
            // 更新所有按钮颜色
            const buttons = document.querySelectorAll('button');
            buttons.forEach(btn => {
                if (btn.style.backgroundColor === 'rgb(66, 133, 244)') {
                    btn.style.backgroundColor = color;
                }
            });
            
            // 通知父窗口更新主题
            if (window.parent && window.parent.applyThemeColor) {
                window.parent.applyThemeColor(color);
            }
        }
        // 显示应用信息
        function showAppInfo() {
            document.getElementById('app-info-modal').style.display = 'flex';
        }
    </script>
</body>
</html>